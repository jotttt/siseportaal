(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function p(a,f,b){var c;return c=a.getWrapperElement().appendChild(document.createElement("div")),c.className=b?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof f?c.innerHTML=f:c.appendChild(f),c}function u(a,f){a.state.currentNotificationClose&&a.state.currentNotificationClose();
a.state.currentNotificationClose=f}a.defineExtension("openDialog",function(h,f,b){function c(a){if("string"==typeof a)d.value=a;else if(!k&&(k=!0,l.parentNode.removeChild(l),n.focus(),b.onClose))b.onClose(l)}var d;b||(b={});u(this,null);var l=p(this,h,b.bottom),k=!1,n=this;if(d=l.getElementsByTagName("input")[0],d){if(d.focus(),b.value&&(d.value=b.value,!1!==b.selectValueOnOpen&&d.select()),b.onInput)a.on(d,"input",function(a){b.onInput(a,d.value,c)});if(b.onKeyUp)a.on(d,"keyup",function(a){b.onKeyUp(a,
d.value,c)});a.on(d,"keydown",function(h){b&&b.onKeyDown&&b.onKeyDown(h,d.value,c)||((27==h.keyCode||!1!==b.closeOnEnter&&13==h.keyCode)&&(d.blur(),a.e_stop(h),c()),13==h.keyCode&&f(d.value,h))});if(!1!==b.closeOnBlur)a.on(d,"blur",c)}else if(h=l.getElementsByTagName("button")[0]){a.on(h,"click",function(){c();n.focus()});if(!1!==b.closeOnBlur)a.on(h,"blur",c);h.focus()}return c});a.defineExtension("openConfirm",function(h,f,b){function c(){k||(k=!0,l.parentNode.removeChild(l),n.focus())}var d;u(this,
null);var l=p(this,h,b&&b.bottom);b=l.getElementsByTagName("button");var k=!1,n=this,q=1;b[0].focus();for(h=0;h<b.length;++h)d=b[h],function(b){a.on(d,"click",function(f){a.e_preventDefault(f);c();b&&b(n)})}(f[h]),a.on(d,"blur",function(){--q;setTimeout(function(){0>=q&&c()},200)}),a.on(d,"focus",function(){++q})});a.defineExtension("openNotification",function(h,f){function b(){d||(d=!0,clearTimeout(l),c.parentNode.removeChild(c))}u(this,b);var c=p(this,h,f&&f.bottom),d=!1,l,k=f&&"undefined"!=typeof f.duration?
f.duration:5E3;a.on(c,"click",function(f){a.e_preventDefault(f);b()});return k&&(l=setTimeout(b,k)),b})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],a):a(CodeMirror)})(function(a){function p(g,b){return"string"==typeof g?g=new RegExp(g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),b?"gi":"g"):g.global||(g=new RegExp(g.source,g.ignoreCase?"gi":"g")),{token:function(b){g.lastIndex=
b.pos;var a=g.exec(b.string);if(a&&a.index==b.pos)return b.pos+=a[0].length||1,"searching";a?b.pos=a.index:b.skipToEnd()}}}function u(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function h(g){return g.state.search||(g.state.search=new u)}function f(g){return"string"==typeof g&&g==g.toLowerCase()}function b(g,b,a){return g.getSearchCursor(b,a,f(b))}function c(g,b,a,f){g.openDialog(b,f,{value:a,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){m(g)}})}function d(g,b,
a,f,c){g.openDialog?g.openDialog(b,c,{value:f,selectValueOnOpen:!0}):c(prompt(a,f))}function l(g,b,a,f){g.openConfirm?g.openConfirm(b,f):confirm(a)&&f[0]()}function k(g){return g.replace(/\\(.)/g,function(g,b){return"n"==b?"\n":"r"==b?"\r":b})}function n(g){var b=g.match(/^\/(.*)\/([a-z]*)$/);if(b)try{g=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(a){}else g=k(g);return("string"==typeof g?""==g:g.test(""))&&(g=/x^/),g}function q(b,a,c){a.queryText=c;a.query=n(c);b.removeOverlay(a.overlay,f(a.query));
a.overlay=p(a.query,f(a.query));b.addOverlay(a.overlay);b.showMatchesOnScrollbar&&(a.annotate&&(a.annotate.clear(),a.annotate=null),a.annotate=b.showMatchesOnScrollbar(a.query,f(a.query)))}function w(b,f,e){var m=h(b),x,k;if(m.query)return v(b,f);x=b.getSelection()||m.lastQuery;e&&b.openDialog?(k=null,c(b,y,x,function(f,c){(a.e_stop(c),f)&&(f!=m.queryText&&q(b,m,f),k&&(k.style.opacity=1),v(b,c.shiftKey,function(a,f){var c;3>f.line&&document.querySelector&&(c=b.display.wrapper.querySelector(".CodeMirror-dialog"))&&
c.getBoundingClientRect().bottom-4>b.cursorCoords(f,"window").top&&((k=c).style.opacity=.4)}))})):d(b,y,"Search for:",x,function(a){a&&!m.query&&b.operation(function(){q(b,m,a);m.posFrom=m.posTo=b.getCursor();v(b,f)})})}function v(g,f,c){g.operation(function(){var d=h(g),e=b(g,d.query,f?d.posFrom:d.posTo);(e.find(f)||(e=b(g,d.query,f?a.Pos(g.lastLine()):a.Pos(g.firstLine(),0)),e.find(f)))&&(g.setSelection(e.from(),e.to()),g.scrollIntoView({from:e.from(),to:e.to()},20),d.posFrom=e.from(),d.posTo=e.to(),
c&&c(e.from(),e.to()))})}function m(b){b.operation(function(){var a=h(b);(a.lastQuery=a.query,a.query)&&(a.query=a.queryText=null,b.removeOverlay(a.overlay),a.annotate&&(a.annotate.clear(),a.annotate=null))})}function z(a,f,c){a.operation(function(){for(var d,e=b(a,f);e.findNext();)"string"!=typeof f?(d=a.getRange(e.from(),e.to()).match(f),e.replace(c.replace(/\$(\d)/g,function(b,a){return d[a]}))):e.replace(c)})}function e(a,f){if(!a.getOption("readOnly")){var c=a.getSelection()||h(a).lastQuery,
e=f?"Replace all:":"Replace:";d(a,e+r,e,c,function(c){c&&(c=n(c),d(a,t,"Replace with:","",function(d){if(d=k(d),f)z(a,c,d);else{m(a);var e=b(a,c,a.getCursor()),h=function(){var f=e.from(),m;!(m=e.findNext())&&(e=b(a,c),!(m=e.findNext())||f&&e.from().line==f.line&&e.from().ch==f.ch)||(a.setSelection(e.from(),e.to()),a.scrollIntoView({from:e.from(),to:e.to()}),l(a,A,"Replace?",[function(){v(m)},h,function(){z(a,c,d)}]))},v=function(b){e.replace("string"==typeof c?d:d.replace(/\$(\d)/g,function(a,f){return b[f]}));
h()};h()}}))})}}var y='Search: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',r=' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',t='With: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',
A="Replace? \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eAll\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e";a.commands.find=function(b){m(b);w(b)};a.commands.findPersistent=function(b){m(b);w(b,!1,!0)};a.commands.findNext=w;a.commands.findPrev=function(b){w(b,!0)};a.commands.clearSearch=m;a.commands.replace=e;a.commands.replaceAll=function(b){e(b,!0)}});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function p(a,b,c,d){var l,k,n,q;this.atOccurrence=!1;this.doc=a;null==d&&"string"==typeof b&&(d=!1);c=c?a.clipPos(c):h(0,0);this.pos={from:c,to:c};"string"!=typeof b?(b.global||(b=new RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(c,d){var m,k,e,l,n;if(c){b.lastIndex=0;m=a.getLine(d.line).slice(0,
d.ch);for(k=0;(b.lastIndex=k,n=b.exec(m),n)&&(e=n,l=e.index,k=e.index+(e[0].length||1),k!=m.length););(k=e&&e[0].length||0)||(0==l&&0==m.length?e=void 0:l!=a.getLine(d.line).length&&k++)}else b.lastIndex=d.ch,m=a.getLine(d.line),k=(e=b.exec(m))&&e[0].length||0,l=e&&e.index,l+k==m.length||k||(k=1);if(e&&k)return{from:h(d.line,l),to:h(d.line,l+k),match:e}}):(l=b,d&&(b=b.toLowerCase()),k=d?function(b){return b.toLowerCase()}:function(b){return b},n=b.split("\n"),1==n.length?this.matches=b.length?function(c,
d){if(c){var m=a.getLine(d.line).slice(0,d.ch),n=k(m),e=n.lastIndexOf(b);if(-1<e)return e=u(m,n,e),{from:h(d.line,e),to:h(d.line,e+l.length)}}else if(m=a.getLine(d.line).slice(d.ch),n=k(m),e=n.indexOf(b),-1<e)return e=u(m,n,e)+d.ch,{from:h(d.line,e),to:h(d.line,e+l.length)}}:function(){}:(q=l.split("\n"),this.matches=function(b,c){var d=n.length-1,l,e,p,r,t;if(b){if(c.line-(n.length-1)<a.firstLine()||k(a.getLine(c.line).slice(0,q[d].length))!=n[n.length-1])return;l=h(c.line,q[d].length);r=c.line-
1;for(t=d-1;1<=t;--t,--r)if(n[t]!=k(a.getLine(r)))return;return(e=a.getLine(r),p=e.length-q[0].length,k(e.slice(p))!=n[0])?void 0:{from:h(r,p),to:l}}if(!(c.line+(n.length-1)>a.lastLine())&&(e=a.getLine(c.line),p=e.length-q[0].length,k(e.slice(p))==n[0])){l=h(c.line,p);r=c.line+1;for(t=1;t<d;++t,++r)if(n[t]!=k(a.getLine(r)))return;if(k(a.getLine(r).slice(0,q[d].length))==n[d])return{from:l,to:h(r,q[d].length)}}}))}function u(a,b,c){var d;if(a.length==b.length)return c;for(b=Math.min(c,a.length);;)if(d=
a.slice(0,b).toLowerCase().length,d<c)++b;else if(d>c)--b;else return b}var h=a.Pos;p.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){a=h(a,0);return c.pos={from:a,to:a},c.atOccurrence=!1,!1}for(var c=this,d=this.doc.clipPos(a?this.pos.from:this.pos.to),l;;){if(this.pos=this.matches(a,d))return this.atOccurrence=!0,this.pos.match||!0;if(a){if(!d.line)return b(0);d=h(d.line-1,this.doc.getLine(d.line-1).length)}else{if(l=
this.doc.lineCount(),d.line==l-1)return b(l);d=h(d.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(f,b){if(this.atOccurrence){var c=a.splitLines(f);this.doc.replaceRange(c,this.pos.from,this.pos.to,b);this.pos.to=h(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};a.defineExtension("getSearchCursor",function(a,b,c){return new p(this.doc,a,b,c)});a.defineDocExtension("getSearchCursor",
function(a,b,c){return new p(this,a,b,c)});a.defineExtension("selectMatches",function(f,b){for(var c=[],d=this.getSearchCursor(f,this.getCursor("from"),b);d.findNext()&&!(0<a.cmpPos(d.to(),this.getCursor("to")));)c.push({anchor:d.from(),head:d.to()});c.length&&this.setSelections(c,0)})});
